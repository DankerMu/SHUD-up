# TSR 物理假设与空间尺度限制（Physical Assumptions & Spatial-Scale Limits）

## 1. 概述：TSR 使用单点太阳位置近似

SHUD 的 TSR（Terrain Shortwave Radiation / 地形短波辐射修正）在计算地形遮蔽与坡面入射短波时，采用“单个全局太阳位置”的近似：在每个 `SOLAR_UPDATE_INTERVAL` 时间桶内，仅基于 B2a 中设置的 `solar_lon_deg/solar_lat_deg`（全局经纬度）计算一次太阳位置，并在整个流域范围内复用该太阳高度角/方位角结果。

该做法显著降低计算量，但隐含“流域内太阳位置空间差异可忽略”的物理假设，因此存在空间尺度适用范围。

## 2. 物理基础：太阳位置的空间变化率

太阳位置（高度角、方位角）主要由时间与地理位置决定。对于同一时刻：

- 纬度变化会改变太阳赤纬投影关系，从而改变高度角/方位角。
- 经度变化会造成地方时（local solar time）差异，从而引入小时角（hour angle）差异；该项通常是小尺度空间差异的主要来源。

在小流域尺度内（几十公里量级），经纬度差异对应的地方时差通常只有数分钟量级，因此太阳位置差异通常较小；当尺度增大到数百公里，地方时差与纬度差会显著增大，单点近似的误差不可忽略。

## 3. 空间尺度分析

- 纬度差异：1 度纬度 ≈ 111 km
- 经度差异：1 度经度 ≈ 111 km × cos(lat)
- 地方时差异：1 度经度 = 4 分钟
- 太阳高度角变化：~0.25°/分钟（中午附近）

一个直观估算：若流域东西向尺度为 `L`（km），则

- 近似经度差 `Δlon(deg) ≈ L / (111·cos(lat))`
- 地方时差 `Δt(min) ≈ 4·Δlon(deg)`
- 中午附近高度角差 `Δα(deg) ≈ 0.25·Δt ≈ Δlon(deg)`

因此，随着 `L` 增大（尤其在高纬度地区 cos(lat) 较小），单点太阳位置近似带来的太阳几何差异会快速累积，并可能传播为 TSR 因子的系统性空间偏差。

## 4. 适用性评估

- 小流域 (<50km)：✅ 优秀，空间差异 <1%
- 中等流域 (50-200km)：⚠️ 可接受，误差 <5%
- 大流域 (>200km)：❌ 需改进，误差 10-20%

说明：上述误差为工程经验量级，用于指导是否需要引入“空间分布式太阳位置”。实际误差与纬度、地形起伏、日照时段（尤其日出/日落附近）、以及 TSR 因子的非线性传播有关。

## 5. SHUD 典型流域案例

- CCW (35km)：✅ 优秀
- Qinghai Lake (170km)：⚠️ 可接受

## 6. 未来改进方向

- ELEMENT_CENTER 模式（每个单元独立计算）：以每个网格单元中心点经纬度计算太阳位置，并保留时间桶更新策略以控制开销。
- 空间插值方案：在少量控制点计算太阳位置，再对全域插值得到空间分布式太阳位置/TSR 因子。
- 分区计算：按子流域/分区（例如经纬度分带或水文分区）独立计算太阳位置与 TSR 因子，在精度与效率之间折中。

